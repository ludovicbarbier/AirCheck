<!doctype html>
<html class="no-js" lang="" style="height: 100%;">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>AirCheck</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/ol.css" type="text/css">
    <script src="js/ol.js"></script>
    <script src="js/moment.js"></script>
    <script src="js/vendor/modernizr-2.8.3.min.js"></script>
</head>
<body style="height: 100%;">
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->
<h1>AirCheck</h1>
<section id="controls">
    <button id="add_data">Add data</button>
</section>
<section id="map" class="map" style="width: 100%; height: 100%;"></section>


<script src="js/vendor/jquery-1.12.0.min.js"></script>
<script src="js/plugins.js"></script>
<script src="js/main.js"></script>
<script>

    $(function () {

        // TODO: This can be removed once we have some real data

        /*
         Symptom source
         */
        var count = 20000;
        var features = new Array(count);
        var e = 4500000;
        for (var i = 0; i < count; ++i) {
            var coordinates = [2 * e * Math.random() - e, 2 * e * Math.random() - e];
            features[i] = new ol.Feature(new ol.geom.Point(coordinates));
        }

        var source = new ol.source.Vector({
            features: features
        });


        var clusterSource = new ol.source.Cluster({
            distance: 40,
            source: source
        });

        var styleCache = {};
        var clusters = new ol.layer.Vector({
            source: clusterSource,
            style: function (feature) {
                var size = feature.get('features').length;
                var style = styleCache[size];
                if (!style) {
                    style = [new ol.style.Style({
                        image: new ol.style.Circle({
                            radius: 10,
                            stroke: new ol.style.Stroke({
                                color: '#fff'
                            }),
                            fill: new ol.style.Fill({
                                color: '#3399CC'
                            })
                        }),
                        text: new ol.style.Text({
                            text: size.toString(),
                            fill: new ol.style.Fill({
                                color: '#fff'
                            })
                        })
                    })];
                    styleCache[size] = style;
                }
                return style;
            }
        });
        clusters.setZIndex(999);

        /*
         WMTS source
         */
        var mapSource = new ol.source.WMTS({
            url: "//map1{a-c}.vis.earthdata.nasa.gov/wmts-geo/wmts.cgi?TIME=2016-04-12",
            layer: "MODIS_Terra_CorrectedReflectance_TrueColor",
            format: "image/jpeg",
            matrixSet: "EPSG4326_250m",
            projection: ol.proj.get("EPSG:4326"),
            tileGrid: new ol.tilegrid.WMTS({
                origin: [-180, 90],
                resolutions: [
                    0.5625,
                    0.28125,
                    0.140625,
                    0.0703125,
                    0.03515625,
                    0.017578125,
                    0.0087890625,
                    0.00439453125,
                    0.002197265625
                ],
                matrixIds: [0, 1, 2, 3, 4, 5, 6, 7, 8],
                tileSize: 512
            })
        });

        var mapLayer = new ol.layer.Tile({
            source: mapSource
        });
        mapLayer.setZIndex(1);

        /*
         KML source for earthdata
         */

        var earthdata = new ol.layer.Vector({
            source: new ol.source.Vector({
                url: 'https://firms.modaps.eosdis.nasa.gov/active_fire/c6/kml/MODIS_C6_Australia_and_New_Zealand_24h.kml',
                format: new ol.format.KML()
            })
        });
        earthdata.setZIndex(100);

        /*
         Get user location
         */

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                alert("This application is not supported by this browser.");
            }
        }

        function showPosition(position) {
            var map = new ol.Map({
                layers: [mapLayer, clusters],
                target: 'map',
                view: new ol.View({
                    center: [position.coords.longitude, position.coords.latitude],
                    zoom: 4
                }),
                renderer: ["canvas", "dom"]
            });
            console.log(position.coords.longitude);
            console.log(position.coords.latitude);
        }

        getLocation();

    });

</script>
</body>
</html>
